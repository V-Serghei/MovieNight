@using MovieNight.Web.Models.Friends
@model MovieNight.Web.Models.Friends.FriendListModel

@{
ViewBag.Title = "FriendsPage";
}

<div>
    <div class="content">

        <!-- Start Content-->
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box">
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">MovieNight</a></li>
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Friends</a></li>
                            </ol>
                        </div>
                        <h4 class="page-title text-warning font-weight-bold">My friends</h4>
                    </div>
                </div>
            </div>
            <!-- end page title -->

            <div class="row">
                <div class="col-12">
                    <div class="card-box">
                        <div class="row">
                            <div class="col-lg-8">
                                <form class="form-inline" method="get" action="@Url.Action("FriendsPage", "SearchSortAdd")">
                                    <div class="form-group">
                                        <label for="searchInput" class="sr-only">Search</label>
                                        <input type="search" class="form-control" id="searchInput" name="searchTerm" placeholder="Search..." value="@Model.SearchTerm">
                                    </div>
                                    <button type="submit" class="btn btn-primary ml-2">Search</button>
                                </form>
                            </div>
                            <div class="col-lg-4">
                                <div class="text-lg-right mt-3 mt-lg-0">
                                    <a href="@Url.Action("FindFriends", "SearchSortAdd", new { _skipParametr = 0 })">
                                        <button type="button" class="btn btn-outline-primary waves-effect waves-light">
                                            <i class="mdi mdi-plus-circle mr-1"></i>
                                            Add friend
                                        </button>
                                    </a>
                                </div>
                            </div><!-- end col-->
                        </div> <!-- end row -->
                    </div> <!-- end card-box -->
                </div><!-- end col-->
            </div>
            <!-- end row -->

            @for (int i = 0; i < Model.ListOfFriends.Count; i += 3)
            {
            <div class="row">
                @for (int j = 0; j < 3; j++)
                {
                if (i + j < Model.ListOfFriends.Count)
                {
                var person = Model.ListOfFriends[i + j];
                <div class="col-lg-4">
                    <div class="text-center card-box ribbon-box">
                        <div class="clearfix"></div>
                        <div class="pt-2 pb-2">
                            <img src="@Url.Content(person.BUserE.Avatar ?? "~/images/users/default_avatar.png")" class="rounded-circle img-thumbnail avatar-xl" alt="profile-image">
                            <h4 class="mt-3 font-17"><a href="extras-profile.html" class="text-dark">@person.BUserE.Username</a></h4>
                            <p><a href="#" class="text-pink">@person.BUserE.Email</a></p>
                            @if (person.Quote != null)
                            {
                            <p class="text-muted font-13 mb-3">@person.Quote</p>
                            }
                            <form action="@Url.Action("Compose", "DataTransfer")" method="get">
                                <button type="submit" class="btn btn-primary btn-sm waves-effect waves-light" name="id" value="@person.BUserE.Id">
                                    <i class="mdi mdi-email mr-1"></i> Message
                                </button>
                            </form>
                            <form action="@Url.Action("SetDeleteFriendPage", "SearchSortAdd")" method="get">
                                <button type="submit" class="btn btn-outline-warning btn-sm waves-effect" name="_friendId" value="@person.BUserE.Id">
                                    <i class="fe-x-circle"></i> Unfriend
                                </button>
                            </form>
                            <a href="@Url.Action("UserTemplatePage", "InformationSynchronization", new { id = person.BUserE.Id })">
                                <button type="button" class="btn btn-outline-warning btn-sm waves-effect">
                                    <i class="remixicon-account-pin-box-fill"></i> Go to profile
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                }
                }
            </div>
            }

            <div class="row">
                <div class="col-12">
                    <div class="text-right">
                        <ul class="pagination pagination-rounded justify-content-end">
                            @if (Model.Pagination.CurrentPage > 1)
                            {
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0);" onclick="loadPage(@((Model.Pagination.CurrentPage - 2) * Model.Pagination.ItemsPerPage))">&laquo;</a>
                            </li>
                            }
                            @for (int i = 1; i <= Model.Pagination.TotalPages; i++)
                            {
                            <li class="page-item @(Model.Pagination.CurrentPage == i ? "active" : "")">
                                <a class="page-link" href="javascript:void(0);" onclick="loadPage(@((i - 1) * Model.Pagination.ItemsPerPage))">@i</a>
                            </li>
                            }
                            @if (Model.Pagination.CurrentPage < Model.Pagination.TotalPages)
                            {
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0);" onclick="loadPage(@((Model.Pagination.CurrentPage) * Model.Pagination.ItemsPerPage))">&raquo;</a>
                            </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div> <!-- container -->
    </div> <!-- content -->
</div>

<script>
    function loadPage(skipParam) {
        var searchTerm = document.getElementById("searchInput").value;
        var url = '@Url.Action("FriendsPage", "SearchSortAdd")';
        url += '?_skipParametr=' + skipParam + '&searchTerm=' + encodeURIComponent(searchTerm);
        window.location.href = url;
    }
</script>
