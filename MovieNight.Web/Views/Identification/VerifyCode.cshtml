@using System.Web.Optimization
@{
ViewBag.Title = "Verify Recovery Code";
Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>MovieNight | @ViewBag.Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
    <meta content="Coderthemes" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="/images/logo.ico">
    @Styles.Render("~/bundles/bootstrap/css")
    @Styles.Render("~/bundles/icons/css")
    @Styles.Render("~/bundles/app/css")
</head>

<body class="authentication-bg">

<div class="account-pages mt-5 mb-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                <div class="card">
                    <div class="card-body p-4">
                        <div class="text-center w-75 m-auto">
                            <a href=@Url.Action("Primary", "MainPage")>
                                <span><img src="~/images/logo_text.png" alt="" height="44"></span>
                            </a>
                            <p class="text-muted mb-4 mt-3">Enter the recovery code sent to your email and your new password.</p>
                        </div>

                        @using (Ajax.BeginForm("VerifyCodeAndResetPassword", "Identification",
                        new AjaxOptions {
                        HttpMethod = "POST",
                        OnSuccess = "onVerifySuccess",
                        OnFailure = "onFailure"
                        },
                        new { id = "verifyCodeForm" }))
                        {
                        @Html.AntiForgeryToken()

                        <div class="form-group mb-3">
                            <label for="code">Recovery Code</label>
                            <input class="form-control" type="text" id="code" name="Code" required="" placeholder="Enter the recovery code">
                        </div>

                        <div class="form-group mb-3">
                            <label for="email">Email</label>
                            <input class="form-control" type="email" id="email" name="Email" required="" placeholder="Enter your email">
                        </div>

                        <div class="form-group mb-3">
                            <label for="newpassword">New Password</label>
                            <input class="form-control" type="password" id="newpassword" name="NewPassword" required="" placeholder="Enter your new password">
                        </div>

                        <div class="form-group mb-0 text-center">
                            <button class="btn btn-primary btn-block" type="submit">Submit</button>
                        </div>
                        }
                    </div> <!-- end card-body -->
                </div>
                <!-- end card -->

                <div class="row mt-3">
                    <div class="col-12 text-center">
                        <p class="text-muted">Back to <a href=@Url.Action("Login", "Identification") class="text-warning font-weight-medium ml-1">Log in</a></p>
                    </div> <!-- end col -->
                </div>
                <!-- end row -->
            </div> <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</div>
<!-- end page -->

<footer id="footer" style="margin-right: 0!important; margin-left: 0!important;" class=" bg-dark text-white py-4">
    <div style="margin-left: 240px">
        @Html.Partial("_Footer")
    </div>
</footer>

@Scripts.Render("~/bundles/vendor/js")
@Scripts.Render("~/bundles/app/js")
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
@Scripts.Render("~/bundles/jqueryunobtrusive")

<script>
    function onVerifySuccess(response) {
        if (response.success) {
            alert('Password successfully reset. You can now log in with your new password.');
            window.location.href = '@Url.Action("Login", "Identification")';
        } else {
            alert(response.message);
        }
    }

    function onFailure() {
        alert('An error occurred. Please try again.');
    }
</script>
</body>
</html>
